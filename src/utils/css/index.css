@tailwind base;
@tailwind components;
@tailwind utilities;

/* ==========================================================
   Reglas globales para asegurar adaptación y evitar overflow
   ========================================================== */
/* Box sizing consistente en toda la app */
*,*::before,*::after { box-sizing: border-box; }

/* Evitar scroll horizontal accidental por anchos calculados, transforms, etc. */
html, body { width:100%; max-width:100%; overflow-x:hidden; }
#root { width:100%; max-width:100vw; overflow-x:hidden; }

/* Medios fluidos */
img, video, canvas, svg, iframe { max-width:100%; height:auto; display:block; }

/* Asegurar que elementos incrustados dentro de mensajes se ajusten */
.message-sent, .message-received { max-width:100%; word-break:break-word; overflow-wrap:anywhere; }

/* Utilidades adicionales */
@layer utilities {
  .break-anywhere { word-break:break-word; overflow-wrap:anywhere; }
  .force-full-screen { width:100vw; max-width:100vw; }
  .no-overflow-x { overflow-x:hidden; }
  .min-w-0 { min-width:0; }
  .chat-composer-wrapper { align-items:flex-end; }
  .chat-composer-wrapper > textarea { width:100%; }
}

/* Evitar que contenedores flex hijos crezcan más allá del viewport por contenido largo */
/* (cuando el desarrollador añada className="min-w-0" a columnas flex) */


body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Asegura que #root ocupe toda la altura para que el fondo aplique a toda la vista */
html, body, #root {
  height: 100%;
}

/* Fondo global desde el root en modo oscuro */
.dark-mode #root {
  background-color: #0a1420; /* fondo base en dark mode aplicado al root */
}

/* Transición suave para modales personalizados */
.modal-transition {
  transition: opacity 0.35s cubic-bezier(0.4,0,0.2,1), transform 0.35s cubic-bezier(0.4,0,0.2,1);
  will-change: opacity, transform;
}

/* Animaciones de entrada para skeletons */
@keyframes fadeIn {
  from { opacity: 0 }
  to { opacity: 1 }
}
@keyframes slideUp {
  from { transform: translateY(8px); opacity: 0 }
  to { transform: translateY(0); opacity: 1 }
}
@keyframes slideRight {
  from { transform: translateX(-8px); opacity: 0 }
  to { transform: translateX(0); opacity: 1 }
}

.anim-fade-in { animation: fadeIn 320ms ease-out both }
.anim-slide-up { animation: slideUp 360ms ease-out both }
.anim-slide-right { animation: slideRight 360ms ease-out both }

/* Nuevo: scale-fade para notices reutilizables */
@keyframes scaleFadeIn {
  0% { opacity:0; transform: scale(.94) translateY(4px); }
  70% { opacity:1; transform: scale(1.015) translateY(0); }
  100% { opacity:1; transform: scale(1); }
}
.scale-fade-in { animation: scaleFadeIn 420ms cubic-bezier(.25,.95,.4,1.05) both; }

/* Fade-out para desmontar suavemente */
@keyframes fadeOut {
  from { opacity: 1; transform: translateY(0) }
  to { opacity: 0; transform: translateY(4px) }
}
.anim-fade-out { animation: fadeOut 360ms ease-out forwards; will-change: opacity, transform }
/* Versión más rápida para overlays breves */
@keyframes fadeOutFast {
  from { opacity: 1; transform: translateY(0) }
  to { opacity: 0; transform: translateY(2px) }
}
.anim-fade-out-fast { animation: fadeOutFast 220ms ease-out forwards; will-change: opacity, transform }

/* Additional modal slide animations (horizontal) */
@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-30px) scale(0.95); }
  to { opacity: 1; transform: translateX(0) scale(1); }
}
@keyframes slideOutRight {
  from { opacity: 1; transform: translateX(0) scale(1); }
  to { opacity: 0; transform: translateX(30px) scale(0.95); }
}
.anim-slide-in-left { animation: slideInLeft 400ms cubic-bezier(0.25,1,0.5,1) forwards; will-change: opacity, transform }
.anim-slide-out-right { animation: slideOutRight 400ms cubic-bezier(0.55,0,0.55,0.2) forwards; will-change: opacity, transform }

/* Overlay fade variants for consistency */
.anim-overlay-fade-in { animation: fadeIn 300ms ease-out forwards; }
.anim-overlay-fade-out { animation: fadeOut 300ms ease-in forwards; }

/* Pequeños retrasos para escalonar elementos */
.anim-delay-1 { animation-delay: 60ms }
.anim-delay-2 { animation-delay: 120ms }
.anim-delay-3 { animation-delay: 180ms }
.anim-delay-4 { animation-delay: 240ms }

/* Emoji Picker specific animations */
@keyframes emojiPickerPopIn {
  0% { opacity: 0; transform: translateY(6px) scale(.96); }
  60% { opacity: 1; transform: translateY(0) scale(1.01); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes emojiPickerPopOut {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(4px) scale(.95); }
}
@keyframes emojiSheetSlideUp {
  0% { transform: translateY(100%); }
  100% { transform: translateY(0); }
}
@keyframes emojiSheetSlideDown {
  0% { transform: translateY(0); }
  100% { transform: translateY(100%); }
}
.emoji-picker-enter-desktop { animation: emojiPickerPopIn 260ms cubic-bezier(.3,.9,.3,1) forwards; }
.emoji-picker-exit-desktop { animation: emojiPickerPopOut 180ms ease-in forwards; }
.emoji-picker-enter-mobile { animation: emojiSheetSlideUp 300ms cubic-bezier(.25,.95,.4,1) forwards; }
.emoji-picker-exit-mobile { animation: emojiSheetSlideDown 240ms cubic-bezier(.55,0,.55,.2) forwards; }

/* ===================== Historias (Stories) ===================== */
@keyframes storyPopIn {
  0% { opacity: 0; transform: translateY(14px) scale(.88); }
  55% { opacity: 1; transform: translateY(0) scale(1.03); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
/* Variante más sutil (para historias ya vistas si se quisiera reutilizar) */
@keyframes storyPopInSoft {
  0% { opacity: 0; transform: translateY(10px) scale(.94); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
.story-animate { 
  opacity: 0; 
  animation: storyPopIn 520ms cubic-bezier(.25,.9,.3,1) both; 
  will-change: opacity, transform; 
}
.story-animate-soft { 
  opacity: 0; 
  animation: storyPopInSoft 420ms ease-out both; 
  will-change: opacity, transform; 
}

/* Animación de salida de historias */
@keyframes storyExit {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  40% { opacity: .6; transform: translateY(4px) scale(.98); }
  100% { opacity: 0; transform: translateY(8px) scale(.9); }
}
.story-exit {
  animation: storyExit 340ms cubic-bezier(.55,0,.55,.2) forwards;
  will-change: opacity, transform;
  pointer-events: none;
}

/* Deshabilitar selección de texto globalmente (sin afectar inputs/editables) */
#root, #root * {
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none; /* iOS: desactiva menú de selección */
}

/* Opt-in: permitir selección donde se necesita */
#root input,
#root textarea,
#root [contenteditable],
#root .allow-text-select,
#root .select-text,
#root pre,
#root code {
  -webkit-user-select: text;
  -ms-user-select: text;
  user-select: text;
  -webkit-touch-callout: default;
}

/* === Reply block differentiated backgrounds === */
@layer utilities {
  .reply-bg-sent {
    background: linear-gradient(135deg, rgba(0,0,0,0.18), rgba(0,0,0,0.05));
  }
  .dark .reply-bg-sent, .dark-mode .reply-bg-sent {
    background: linear-gradient(135deg, rgba(255,255,255,0.11), rgba(255,255,255,0.04));
  }
  .reply-bg-received {
    background: linear-gradient(135deg, rgba(0,0,0,0.10), rgba(0,0,0,0.02));
  }
  .dark .reply-bg-received, .dark-mode .reply-bg-received {
    background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
  }
  .reply-preview-solid {
    background: linear-gradient(125deg, #ffffff, #f1f5f9); /* slate-50 to slate-100 */
  }
  .dark .reply-preview-solid, .dark-mode .reply-preview-solid {
    background: linear-gradient(125deg, #0b1220, #071325); /* más oscuro y neutro para evitar tonos muy azules */
  }
  /* Ajustes de color internos (usamos selectores más genéricos para evitar problemas con corchetes) */
  .reply-preview-solid .truncate { color: #0f172a; }
  .dark .reply-preview-solid .truncate, .dark-mode .reply-preview-solid .truncate { color: #e6eef8; }
  .reply-preview-solid .reply-label { color: #334155; }
  .dark .reply-preview-solid .reply-label, .dark-mode .reply-preview-solid .reply-label { color: #93a4b6; }

  /* Mejor contraste: añadir borde y sombra sutil en modo oscuro para separar del fondo */
  .reply-preview-solid { border-radius: 8px; }
  .dark .reply-preview-solid, .dark-mode .reply-preview-solid { border: 1px solid rgba(255,255,255,0.04); box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset; }

  /* Ajustes para reply-bg sent/received: más contraste en dark mode y texto legible */
  .reply-bg-sent { border-radius: 6px; }
  .dark .reply-bg-sent, .dark-mode .reply-bg-sent { background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset; }

  .reply-bg-received { border-radius: 6px; }
  .dark .reply-bg-received, .dark-mode .reply-bg-received { background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.02); }
}